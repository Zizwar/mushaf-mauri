{"version":3,"sources":["../../../../src/start/server/Bonjour.ts"],"sourcesContent":["import { ExpoConfig, getConfig } from '@expo/config';\n\nimport { env } from '../../utils/env';\n\nconst debug = require('debug')('expo:start:server:bonjour') as typeof console.log;\n\nexport class Bonjour {\n  private stopAdvertising?: () => Promise<void>;\n\n  constructor(\n    /** Project root directory */\n    private projectRoot: string,\n    /** Port to advertise, if any */\n    private port: number | undefined\n  ) {}\n\n  public async announceAsync({\n    exp = getConfig(this.projectRoot).exp,\n  }: {\n    exp?: Pick<ExpoConfig, 'name' | 'description' | 'slug' | 'primaryColor'>;\n  }) {\n    if (env.CI || !env.EXPO_UNSTABLE_BONJOUR) {\n      return;\n    } else if (!this.port) {\n      return;\n    }\n\n    const dnssd: typeof import('dnssd-advertise') = await import('dnssd-advertise');\n    if (this.stopAdvertising) {\n      await this.stopAdvertising();\n    }\n\n    debug('Started Bonjour service');\n    this.stopAdvertising = dnssd.advertise({\n      name: `${exp.name}`,\n      type: 'expo',\n      protocol: 'tcp',\n      hostname: exp.slug,\n      port: this.port,\n      stack: 'IPv4',\n      txt: {\n        name: exp.name?.slice(0, 255),\n        slug: exp.slug?.slice(0, 255),\n      },\n    });\n  }\n\n  public async closeAsync(): Promise<boolean> {\n    if (!this.stopAdvertising) {\n      return false;\n    } else {\n      debug('Stopped Bonjour service');\n      await this.stopAdvertising?.();\n      this.stopAdvertising = undefined;\n      return true;\n    }\n  }\n}\n"],"names":["Bonjour","debug","require","constructor","projectRoot","port","announceAsync","exp","getConfig","env","CI","EXPO_UNSTABLE_BONJOUR","dnssd","stopAdvertising","advertise","name","type","protocol","hostname","slug","stack","txt","slice","closeAsync","undefined"],"mappings":";;;;+BAMaA;;;eAAAA;;;;yBANyB;;;;;;qBAElB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEpB,MAAMC,QAAQC,QAAQ,SAAS;AAExB,MAAMF;IAGXG,YACE,2BAA2B,GAC3B,AAAQC,WAAmB,EAC3B,8BAA8B,GAC9B,AAAQC,IAAwB,CAChC;aAHQD,cAAAA;aAEAC,OAAAA;IACP;IAEH,MAAaC,cAAc,EACzBC,MAAMC,IAAAA,mBAAS,EAAC,IAAI,CAACJ,WAAW,EAAEG,GAAG,EAGtC,EAAE;YAqBSA,WACAA;QArBV,IAAIE,QAAG,CAACC,EAAE,IAAI,CAACD,QAAG,CAACE,qBAAqB,EAAE;YACxC;QACF,OAAO,IAAI,CAAC,IAAI,CAACN,IAAI,EAAE;YACrB;QACF;QAEA,MAAMO,QAA0C,MAAM,mEAAA,QAAO;QAC7D,IAAI,IAAI,CAACC,eAAe,EAAE;YACxB,MAAM,IAAI,CAACA,eAAe;QAC5B;QAEAZ,MAAM;QACN,IAAI,CAACY,eAAe,GAAGD,MAAME,SAAS,CAAC;YACrCC,MAAM,GAAGR,IAAIQ,IAAI,EAAE;YACnBC,MAAM;YACNC,UAAU;YACVC,UAAUX,IAAIY,IAAI;YAClBd,MAAM,IAAI,CAACA,IAAI;YACfe,OAAO;YACPC,KAAK;gBACHN,IAAI,GAAER,YAAAA,IAAIQ,IAAI,qBAARR,UAAUe,KAAK,CAAC,GAAG;gBACzBH,IAAI,GAAEZ,YAAAA,IAAIY,IAAI,qBAARZ,UAAUe,KAAK,CAAC,GAAG;YAC3B;QACF;IACF;IAEA,MAAaC,aAA+B;QAC1C,IAAI,CAAC,IAAI,CAACV,eAAe,EAAE;YACzB,OAAO;QACT,OAAO;YACLZ,MAAM;YACN,OAAM,IAAI,CAACY,eAAe,oBAApB,IAAI,CAACA,eAAe,MAApB,IAAI;YACV,IAAI,CAACA,eAAe,GAAGW;YACvB,OAAO;QACT;IACF;AACF"}