{"version":3,"sources":["../../../../../src/start/server/metro/externals.ts"],"sourcesContent":["/**\n * Copyright Â© 2023 650 Industries.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\nimport fs from 'fs';\nimport { builtinModules } from 'module';\nimport path from 'path';\n\n// TODO(@kitten): When `builtinModules` isn't present, we instead use the `process.binding('natives')` internal\n// call which is almost equivalent. It's unclear from the History in Node.js' docs whether this fallback is still necessary\n// https://nodejs.org/api/module.html#modulebuiltinmodules\ndeclare global {\n  namespace NodeJS {\n    interface Process {\n      binding?(key: 'natives'): Record<string, unknown>;\n    }\n  }\n}\n\n// A list of the Node.js standard library modules that are currently\n// available,\nexport const NODE_STDLIB_MODULES: string[] = [\n  // Add all nested imports...\n  'assert/strict',\n  'dns/promises',\n  'inspector/promises',\n  'fs/promises',\n  'stream/web',\n  'stream/promises',\n  'path/posix',\n  'path/win32',\n  'readline/promises',\n  'stream/consumers',\n  'timers/promises',\n  'util/types',\n  'sqlite',\n\n  // Collect all builtin modules...\n  ...(\n    builtinModules ||\n    (process.binding ? Object.keys(process.binding('natives')) : []) ||\n    []\n  ).filter((x) => !/^(internal|v8|node-inspect)\\/|\\//.test(x) && !['sys'].includes(x)),\n].sort();\n\nconst shimsFolder = path.join(require.resolve('@expo/cli/package.json'), '../static/shims');\n\nexport function shouldCreateVirtualShim(normalName: string) {\n  const shimPath = path.join(shimsFolder, normalName);\n  if (fs.existsSync(shimPath)) {\n    return shimPath;\n  }\n  return null;\n}\n\nexport function isNodeExternal(moduleName: string): string | null {\n  const moduleId = moduleName.replace(/^node:/, '');\n  if (NODE_STDLIB_MODULES.includes(moduleId)) {\n    return moduleId;\n  }\n  return null;\n}\n"],"names":["NODE_STDLIB_MODULES","isNodeExternal","shouldCreateVirtualShim","builtinModules","process","binding","Object","keys","filter","x","test","includes","sort","shimsFolder","path","join","require","resolve","normalName","shimPath","fs","existsSync","moduleName","moduleId","replace"],"mappings":"AAAA;;;;;CAKC;;;;;;;;;;;IAkBYA,mBAAmB;eAAnBA;;IAkCGC,cAAc;eAAdA;;IARAC,uBAAuB;eAAvBA;;;;gEA3CD;;;;;;;yBACgB;;;;;;;gEACd;;;;;;;;;;;AAeV,MAAMF,sBAAgC;IAC3C,4BAA4B;IAC5B;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IAEA,iCAAiC;OAC9B,AACDG,CAAAA,wBAAc,IACbC,CAAAA,QAAQC,OAAO,GAAGC,OAAOC,IAAI,CAACH,QAAQC,OAAO,CAAC,cAAc,EAAE,AAAD,KAC9D,EAAE,AAAD,EACDG,MAAM,CAAC,CAACC,IAAM,CAAC,mCAAmCC,IAAI,CAACD,MAAM,CAAC;YAAC;SAAM,CAACE,QAAQ,CAACF;CAClF,CAACG,IAAI;AAEN,MAAMC,cAAcC,eAAI,CAACC,IAAI,CAACC,QAAQC,OAAO,CAAC,2BAA2B;AAElE,SAASf,wBAAwBgB,UAAkB;IACxD,MAAMC,WAAWL,eAAI,CAACC,IAAI,CAACF,aAAaK;IACxC,IAAIE,aAAE,CAACC,UAAU,CAACF,WAAW;QAC3B,OAAOA;IACT;IACA,OAAO;AACT;AAEO,SAASlB,eAAeqB,UAAkB;IAC/C,MAAMC,WAAWD,WAAWE,OAAO,CAAC,UAAU;IAC9C,IAAIxB,oBAAoBW,QAAQ,CAACY,WAAW;QAC1C,OAAOA;IACT;IACA,OAAO;AACT"}