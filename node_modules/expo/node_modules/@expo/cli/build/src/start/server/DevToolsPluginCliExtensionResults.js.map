{"version":3,"sources":["../../../../src/start/server/DevToolsPluginCliExtensionResults.ts"],"sourcesContent":["import z from 'zod';\n\nimport { DevToolsPluginOutput, DevToolsPluginOutputSchema } from './DevToolsPlugin.schema';\n\n/**\n * Class that collects and manages output from executed plugin commands\n *\n * Responsibilities:\n * - Collects output data from executed commands\n * - Parses and validates output data against expected schema\n * - Provides methods to append new output entries\n * - Handles exit codes and appends relevant messages\n * - Handles streaming of output via optional callback\n */\nexport class DevToolsPluginCliExtensionResults {\n  constructor(private onOutput?: (output: DevToolsPluginOutput) => void) {}\n\n  private _output: DevToolsPluginOutput = [];\n\n  public append(output: string, level: 'info' | 'warning' | 'error' = 'info') {\n    const results = this.parseOutputText(output, level);\n    this._output.push(...results);\n    this.onOutput?.(results);\n  }\n\n  public exit(code: number) {\n    if (code === 0) return;\n    this.append(`Process exited with code ${code}`, 'error');\n  }\n\n  public getOutput(): DevToolsPluginOutput {\n    return this._output;\n  }\n\n  private parseOutputText(\n    txt: string,\n    level: 'info' | 'warning' | 'error' = 'info'\n  ): DevToolsPluginOutput {\n    // Validate against schema\n    try {\n      const result = DevToolsPluginOutputSchema.safeParse(JSON.parse(txt));\n      if (!result.success) {\n        return [\n          {\n            type: 'text',\n            text: `Invalid JSON: ${result.error.issues.map((issue) => issue.message).join(', ')}`,\n            level: 'error',\n          },\n        ];\n      }\n      return result.data;\n    } catch {\n      // Not JSON, treat as plain text\n      const lines = txt.split('\\n');\n      const results: DevToolsPluginOutput = [];\n      for (const line of lines) {\n        if (line) {\n          results.push({ type: 'text', text: line, level });\n        }\n      }\n      return results;\n    }\n  }\n}\n"],"names":["DevToolsPluginCliExtensionResults","constructor","onOutput","_output","append","output","level","results","parseOutputText","push","exit","code","getOutput","txt","result","DevToolsPluginOutputSchema","safeParse","JSON","parse","success","type","text","error","issues","map","issue","message","join","data","lines","split","line"],"mappings":";;;;+BAcaA;;;eAAAA;;;sCAZoD;AAY1D,MAAMA;IACXC,YAAY,AAAQC,QAAiD,CAAE;aAAnDA,WAAAA;aAEZC,UAAgC,EAAE;IAF8B;IAIjEC,OAAOC,MAAc,EAAEC,QAAsC,MAAM,EAAE;QAC1E,MAAMC,UAAU,IAAI,CAACC,eAAe,CAACH,QAAQC;QAC7C,IAAI,CAACH,OAAO,CAACM,IAAI,IAAIF;QACrB,IAAI,CAACL,QAAQ,oBAAb,IAAI,CAACA,QAAQ,MAAb,IAAI,EAAYK;IAClB;IAEOG,KAAKC,IAAY,EAAE;QACxB,IAAIA,SAAS,GAAG;QAChB,IAAI,CAACP,MAAM,CAAC,CAAC,yBAAyB,EAAEO,MAAM,EAAE;IAClD;IAEOC,YAAkC;QACvC,OAAO,IAAI,CAACT,OAAO;IACrB;IAEQK,gBACNK,GAAW,EACXP,QAAsC,MAAM,EACtB;QACtB,0BAA0B;QAC1B,IAAI;YACF,MAAMQ,SAASC,gDAA0B,CAACC,SAAS,CAACC,KAAKC,KAAK,CAACL;YAC/D,IAAI,CAACC,OAAOK,OAAO,EAAE;gBACnB,OAAO;oBACL;wBACEC,MAAM;wBACNC,MAAM,CAAC,cAAc,EAAEP,OAAOQ,KAAK,CAACC,MAAM,CAACC,GAAG,CAAC,CAACC,QAAUA,MAAMC,OAAO,EAAEC,IAAI,CAAC,OAAO;wBACrFrB,OAAO;oBACT;iBACD;YACH;YACA,OAAOQ,OAAOc,IAAI;QACpB,EAAE,OAAM;YACN,gCAAgC;YAChC,MAAMC,QAAQhB,IAAIiB,KAAK,CAAC;YACxB,MAAMvB,UAAgC,EAAE;YACxC,KAAK,MAAMwB,QAAQF,MAAO;gBACxB,IAAIE,MAAM;oBACRxB,QAAQE,IAAI,CAAC;wBAAEW,MAAM;wBAAQC,MAAMU;wBAAMzB;oBAAM;gBACjD;YACF;YACA,OAAOC;QACT;IACF;AACF"}